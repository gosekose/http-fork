# 프락시

<br>

### 6.1 웹 중개자

- 웹 프락시 서버는 클라이언트 입장에서 트랜잭션을 수행하는 중개인
- HTTP 프락시 서버는 우ㅐㅂ 서버이기도 하고 웹 클라이언트이기도 함
- 프락시는 HTTP 클라이언트의 요청을 받게 되므로, 반드시 웹 서버처럼 요청과 커넥션을 적절히 다루고 응답을 돌려줘야 함
- 동시에 프락시는 요청을 서버로 보내기도 하므로 요청을 보내고 응답을 받는 올바른 HTTP 클라이언트처럼 동작해야 함

### 6.1.1 개인 프락시와 공유 프락시

- 프락시 서버는 하나의 클라이언트가 독립적으로 사용할 수 있고, 여러 클라이언트가 공유할 수 있음
- 하나의 클라이언트만을 위한 프락시를 개인 프락시라고 부름
- 여러 클라이언트가 함께 사용하는 프락시는 공용 프락시라고 부름

- 공용 프락시
    - 대부분 프락시는 공용이며 공유된 프락시
    - 중앙 집중형 프락시를 관리하는게 더 비용 효율이 높음
    - 캐시 프락시 서버와 같은 몇몇 프락시 애플리케이션은 프락시를 이용하는 사용자가 많을수록 유리
    - 여러 사용자들의 공통된 요청에서 이득을 취할 수 있음
- 개인 프락시

### 6.1.2 프락시 대 게이트웨이

- 프락시는 같은 프로토콜을 사용하는 둘 이상의 애플리케이션을 연결
- 게이트웨이는 서로 다른 프로토콜을 사용하는 둘 이상을 연결
- 게이트웨이는 클라이언트와 서버가 서로 다른 프로토콜로 말하더라도 서로 간의 트랜잭션을 완료할 수 있도록 해주는 프로토콜 변환기처럼 동작
- 때때로 프락시는 약간의 프로토콜을 변환하기도 함

## 6.2 왜 프락시를 사용하는가?

- 프락시 서버는 실용적이고 유용한 것이라면 무슨 일이든 함
- 보안을 개선하고 성능을 높여주며 비용을 절약
- 프락시 서버는 모든 HTTP 트래픽을 들여다보고 건드릴 수 있기 때문에 프락시는 부가적인 가치를 주는 여러 유용한 웹 서비스를 구현
- 트래픽을 감시하고 수정할 수 있음

- 어린이 보호
- 문서 접근 제어자
- 보안 방화벽
- 웹 캐시
- 대리 프락시
    - 서버 가속기
- 콘텐츠 라우터
    - 프락시 서버는 인터넷 트래픽 조건과 콘텐츠 종류에 따라 요청을 특정 웹서버로 유도하는 콘텐츠 라우터로 동작
    - 콘텐츠 라우터는 또한 사용자들에게 제공할 여러 서비스를 구현하는데 사용할 수 있음
- 트랜스코더
    - 데이터 표현 방식을 자연스럽게 변환하는 것을 트랜스코딩
- 익명화 프락시
    - HTTP 메세지에서 신원을 식별할 수 있는 특성들을 적극적으로 제거함으로써 개인정보 보호와 익명성 보장에 기여
        - IPm From 헤더, Referer 헤더, 쿠키, URI 세션 아이디
    - User-Agent 헤더에서 사용자의 컴퓨터와 OS 종류 제거
    - 사용자의 이메일 주소를 보호하기 위해 From 헤더는 제거
    - 어떤 사이트를 거쳐서 방문했는지 알기 어렵게 하기 위해 Referer 헤더는 제거
    - 프로필과 신원 정보를 업애기 위해 Cookie 헤더는 제거

### 6.3 프락시는 어디에 있는가?

- 프락시 서버 배치

- 출구 프락시
    - 로컬 네트워크와 더 큰 인터넷 사이를 오가는 트래픽을 제어하기 위해 프락시를 로컬 네트워크의 출구에 넣을 수 있음
    - 회사 밖의 악의적인 해커들을 막는 방화벽을 제거하기 위해, 혹은 인터넷 요금을 절약하고 인터넷 트래픽 성능을 개선하기 위해 회사에서 출구 프락시를 사용할 수 있음
    - 어린이 보호 필터링 가능
    - 클라이언트 <--- 로컬 네트워크 ----> 프락시 <---- 인터넷 ----> 서버

- 접근 프락시
    - 고객으로부터의 모든 요청을 종합적으로 처리하기 위해 프락시는 ISP 접근 지점에 위치하기도 함
    - 다운로드 속도를 개선하고 인터넷 대역폭 비용을 줄이기 위해 캐시 프락시를 사용해 많이 찾는 문서들의 사본을 저장
    - 클라이언트 <--- ISP ----> 프락시 <---- 인터넷 ----> 서버

- 대리 프락시
    - 프락시는 종종 대리 프락시로 사용
    - 네트워크의 가장 끝에 있는 웹 서버들의 바로 앞에 위치
    - 웹 서버로 향하는 모든 요청을 처리하고 필요할 때만 웹 서버애개 자원을 요청
    - 보안 / 성능 개선 / 대리 프락시는 일반적으로 웹 서버의 이름과 IP 주소로 스스로를 가장 -> 모든 요청은 서버가 아닌 프락시로 감
    - 클라이언트 <--- 인터넷 ----> 프락시 <---- 로컬 네트워크 ----> 서버

- 네트워크 교환 프록시
    - 캐시를 이용헤 인터넷 교차로의 혼잡을 완화하고 트래픽 흐름을 감시
    - 충분한 처리 능력을 갖춘 프락시가 네트워크 사이의 인터넷 피어링 교환 지점들에 놓일 수 있음
    -
        - 클라이언트 <--- 네트워크1 ----> 라우터 <-> 프락시 <-> 라우터 <---- 네트워크2 ----> 서버

### 6.3.2 프락시 계층

- 프락시들은 프락시 계층이라고 불리는 연쇄를 구성할 수 있음
- 프락시 계층에서 메세지는 최종적으로 원 서버에 도착할 때 까지 프락시와 프락시를 거쳐 이동
- 프락시 계층에서 프락시 서버들은 부모와 자식의 관계를 가짐
- 인바운드 프락시를 부모(서버와 가까운 쪽)라고 부르고 다음번 아웃바운드 프락시(클라이언트 가까운 쪽)는 자식이라고 부름
- 클라이언트 <-> 프락시 3 <-> 프락시 2 <-> 프락시 1 <-> 서버
    - 프락시 1은 프락시 2의 부모
    - 프락시 2는 프락시 3의 부모
- 프락시 계층의 콘텐츠 라우팅
    - 프락시 계층은 정적, 프락시 1은 언제나 메세지를 프락시 2로 보냄
    - 계층이 반드시 정적이어야 하는 것은 아님
    - 프락시 서버는 여러 가지 판단 근거에 의해 메세지를 다양하고 유동적인 프락시 서버와 원 서버들의 집합에게 보낼 수 있음
- 부하 균형
- 지리적 인접성에 근접한 라우팅
- 프로토콜/타입 라우팅
- 유료 서비스 가입자를 위한 라우팅

### 6.3.3 어떻게 프락시가 트래픽을 처리하는가?

- 클라이언트를 수정
    - 클라이언트는 HTTP 요청을 바로 의도적으로 원 서버가 아닌 프락시로 보냄
- 네트워크를 수정
    - 클라이언트는 알지도 못하고 간섭도 할 수 없는 상태에서, 네트워크 인프라를 가로채서 웹 트래픽을 프락시로 가도록 조정하는 몇 가지 방법이 있음
    - 이 가로챔은 일반적으로 HTTP 트래픽을 지켜보고 가로채어 클라이언트 모르게 트래픽을 프락시로 보내는 스위칭 장치와 라우팅 장치를 필요로 함
- DNS 이름공간을 수정
    - 웹 서버 앞에 위치하는 프락시 서버인 대리 프락시는 웹 서버의 이름과 IP 주소를 자신이 직접 사용
    - 모든 요청은 서버 대신 대리 프락시로 감
    - DNS 이름 테이블을 수도응로 편집하거나 사용할 적절한 프락시나 서버를 계산해주는 동적 DNS 서버를 이용해서 조정될 수 있음
- 웹 서버를 수정
    - HTTP 리다이렉션 명령 (305)를 클라이언트에게 돌려줌으로써 클라이언트의 요청을 프락시로 리다이렉트 하도록 설정 가능
    - 리다이렉트를 받는 즉시 클라이언트는 프락시와 트랜잭션을 수행

### 6.4 클라이언트 프락시 설정

- 수동 설정
- 브라우저 기본 설정
- 프락시 자동 설정
    - 자바스크립트 프락시 자동설정(PAC) 파일에 대한 URI를 제공할 수 있음
    - 클라이언트는 프락시를 써야 하는지, 어떤 프락시를 서버에 써야 하는지 판단하기 위해 자바스크립트 파일을 가져와서 실행
- WPAD 프락시 발견
    - 대부분의 브라우저는 자동설정 파일을 다운받을 수 있는 설정 파일을 자동으로 찾아주는 웹 프락시 자동발견 프로토콜을 제공

### 6.4.1 클라이언트 프록시 설정: 수동

- 많은 웹 클라이언트가 프락시를 수동으로 설정할 수 있도록 함
- 구글 크롬과 마이크로소프트 인터넷 익스플로러 둘 모두 간편하게 프록시 설정 가능
- 프락시의 호스트와 포트를 지정
- 수동 프록시 -> 유연 X
-

### 6.4.2 클라이언트 프록시 설정: PAC 파일

- 프록시 자동 설정 PAC 파일은 프록시 설정에 대한 동적 해결책 제공
- 프록시 설정을 상황에 맞게 자동 계산해주는 작은 자바스크립트 파일
- PAC 파일을 사용하려면, 자바스크립트 PAC 파일의 URI를 브라우저에게 설정 해야 함
- 브라우저는 URI로 PAC를 가져와서 매 접근마다 적절한 프록시 서버를 계산힉 위해 자바스크립트 로직을 이용
- PAC 파일은 .pac 확장자
- PAC 파일은 반드시 URI에 접근할 떄 사용할 적절한 프락시 서버를 계산해주는 FindProxyFortUrl 함수를 정의 해야 함

### 6.4.3 클라이언트 프록시 설정 WPAD

- 자동발견 프로토콜 (WPAD)
- 여러 매커니즘의 상승 전략을 이용해 브라우저에게 알맞은 PAC 파일을 자동으로 찾아주는 알고리즘
    - PAC URI를 찾기 위해 WPAD를 사용
    - 주어진 URI에서 PAC 파일을 가져옴
    - 프록시 서버를 알아내기 위해 PAC 파일을 실행
    - 알아낸 프록시 서버를 이용해 요청을 처리
- 리소스 발견 기법을 사용
    - 동적 호스트 발견 규약 DHCP
    - 서비스 위치 규약 SLP
    - DNS 잘 알려진 호스트명
    - DNS SRV 레코드
    - DNS TXT 레코드 안의 서비스 URI