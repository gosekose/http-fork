# HTTP 메세지

<br>

## 3.1 메세지의 흐름

- HTTP 메세지는 메세지의 내용과 의미를 설명하는 텍스트 메타 정보로 시작하고 그 다음에 선택적으로 데이터가 올 수 있음

### 3.1.1 메세지는 원 서버 방향을 인바운드로 하여 송신

- 메세지가 원 서버로 향하는 것은 인바운드로 이동
    - GET /index.html HTTP/1.0
- 모든 처리가 끝난 뒤에 메세지가 사용자 에이전트 돌아오는 것은 아웃바운드로 이동하는 것
    - HTTP/1.0 200 OK
    - Content-type: text/html

### 3.1.2 다운스트림으로 흐르는 메세지

- 요청/응답 메세지에 관계없이 모든 메세지는 다운스트림으로 흐름
- 메세지의 발송자는 수신자의 업스트림

<br>

## 3.2 메세지의 각 부분

- HTTP 메세지는 단순한, 데이터의 구조화된 블록
- 메세지는 시작줄, 헤더 블록, 본문 세 부분으로 구분
    - 시작줄: 어떤 메세지인지 서술
    - 헤더 블록: 속설
    - 본문: 데이터
    - 헤더와 본문을 구분: `CRLF (carriage return)`
  ``` http request
     HTTP/1.0 200 OK\r\n
     Content-type: text/plain\r\n
     Content-length: 19\r\n
     \r\n
     Hi! I'm a message!
  ```

### 3.2.1 메세지 문법 및 상세 설명

- 시작줄
    - 요청줄
        - 요청 메세지의 시작줄, 혹은 요청줄에는 서버에서 어떤 동작이 일어나야 하는지 설명해주는 메서드와 그 동작에 대한 대상을 지칭하는 요청 URL이 들어 있음
        - 요청줄은 클라이언트가 어떤 HTTP 버전으로 말하고 있는지 서버에게 알려주는 HTTP 버전도 포함
    - 응답줄
        - 응답 메세지의 시작줄 혹은 응답줄에는 버전, 상태코드, 수행 상태에 대해 설명해주는 텍스트로 된 사유 구절
    - 메서드
        - 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작

      |메서드|설명|메세지에 본문이 있는가?|
                                                                                                                                     |:---:|:---:|:---:|
      |GET|어떤 문서를 가져옴|X|
      |HEAD|헤더 가져옴|X|
      |POST|처리해야 할 데이터를 보냄|O|
      |PUT|서버 요청 메세지의 본문을 저장|O|
      |TRACE|메세지가 프락시를 거쳐 서버에 도달하는 과정 추적|X|
      |OPTIONS|어떤 메서드를 수행하는지 확인|X|
      |DELETE|문서 제거|X|

    - 상태코드
        - 상태 코드는 각 응답 메세지의 시작줄에 담겨 반환

      | 전체 범위   | 정의된 범위  |    분류    |
                                                                                                                                    |:-------:|:-------:|:--------:|
      | 100-199 | 100-101 |    정보    |
      | 200-299 | 200-206 |    성공    |
      | 300-399 | 300-305 |  리다이렉션   |
      | 400-499 | 400-415 | 클라이언트 에러 |
      | 500-599 | 500-505 |  서버 에러   |
    - 사유 구절
        - 응답 시작줄의 마지막 구성요소
        - 상태 코드에 대한 글로 된 설명을 제공 (ex: OK)
    - 버전 번호
        - 버전 번호는 HTTP/x,y 형식으로 요청과 응답 메세지 양쪽 모두에 기술
        - HTTP 애플리케이션이 자신을 따르는 프로토콜의 버전을 상대방에게 말해주기 위한 수단
        - 버전 번호는 어떤 애플리케이션이 지원하는 가장 높은 HTTP 버전을 가리킴
        - 2.22 > 2.3
- 헤더
    - 헤더 필드는 요청과 응답 메세지에 추가 정보를 더함
    - 기본적으로 이름/값 쌍의 목록
    - 헤더 분류

  | 헤더 분류  |           정의된 범위           |
                                        |:------:|:--------------------------:|
  |   일반   |     요청과 응답 양쪽에 모두 나타냄      |
  |   요청   |        요청에 대한 부가 정보        |
  |   응답   |        응답에 대한 부가 정보        |
  | Entity | 본문 크기와 콘텐츠 혹은 리소스 그 자체를 서술 |
  |   확장   |     명세에 정의되지 않은 새로운 헤더     |

- 엔티티 본문
    - HTTP 메세지의 세 번째 부분은 선택적인 엔티티 본문

<br>

## 3.3 메서드

### 3.3.1 안전한 메서드

- 안전한 메서드가 서버에 작용을 유발하지 않는다는 보장은 없음
- 안전한 메서드의 목적은 서버에 어떤 영향을 줄 수 있는 안전하지 않은 메서드가 사용될 때, 그 사실을 알려주는 애플리케이션을 만들 수 있도록 하는 것

### 3.3.2 GET

- 리소스 응답

``` http request
GET /sessional/index.html HTTP/1.1
Host: www.com
Accept: *

HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 617

<HTML></HTML
```

### 3.3.3 HEAD

- 리소스를 가져오지 않고, 그에대한 타입, 개체 존재, 리소스 변경 여부 확인
- 엔티티 본문 없음

``` http request
HEAD /sessional/index.html HTTP/1.1
Host: www.com
Accept: *

HTTP/1.1 200 OK
Content-Type: text/html
Content-Length: 617
```

### 3.3.4 PUT

- 서버에 문서를 씀
- 서버가 요청의 본문을 가지고 요청 URL의 이름대로 새 문서를 만들거나. 이미 URL이 존재한다면 본문을 사용해서 교체

``` http request
PUT /product-list.txt HTTP/1.1
Host: www.com
Content-Type: text/plain
Content-Length: 34

Updated product!

HTTP/1.1 201 Created
Location: http://www.product.com
Content-Type: text/html
Content-Length: 617

http://www.product.com
```

### 3.3.5 POST

- 서버에 입력 데이터를 전송하기 위해 설계

### 3.3.6 TRACE

- 클라이언트가 어떤 요청을 할 때, 그 요청은 방화벽, 프락시, 게이트웨이 등의 애플리케이션을 통과
- 이들에게 원래의 HTTP 요청을 수정할 수 있는 기회가 있음
- TRACE 요청은 목적지 서버에서 루프백 진단을 시작
- 요청 전송의 마지막 단계에 있는 서버는 자신이 받은 요청 메세지를 본문에 넣어 TRACE 응답으로 되돌려 줌
- 클라이언트는 자신과 목적지 서버 사이에 있는 모든 HTTP 애플리케이션의 요청/응답 연쇄를 따라가면서 자신이 보낸 메세지가 망가졌거나 수정되었는지 확인

### 3.3.7 OPTIONS

- 웹 서버에게 여러 가지 종류의 지원 범위에 대해 물어봄
- 서버에게 특정 리소스에 대해 어떤 메서드가 지원되는지 물어볼 수 있음

``` http request
OPTIONS * HTTP/1.0
Host: www.com
Accept: *

HTTP/1.1 200 OK
Allow: GET, POST, PUT, OPTIONS
Content-length: 0
```

### 3.3.8 DELETE

- 리소스 삭제 요청 but, 클라이언트는 삭제가 수행되는 것을 보장 X

### 3.3.9 확장 메서드

- 엄격하게 보내고 관대하게 받아들여라 라는 오랜 규칙을 따르기

<br>

## 3.4 상태코드

### 3.4.1 100~199: 정보성 상태 코드

- 정보성 상태 코드는 HTTP/1.1에서 도입

| 상태코드 |        사유 구절        |                       의미                        |
|:----:|:-------------------:|:-----------------------------------------------:|
| 100  |      Continue       | 요청의 시작 부분 일부가 받아들여졌으며, 클라이언트는 나머지를 계속 이어서 보내야 함 |
| 101  | Switching Protocols |  클라이언트가 Upgrade 헤더에 나열한 것 중 하나로 서버가 프로토콜을 바꾸었음  |

- Client와 100 Continue
    - 만약 클라이언트가 엔티티를 서버에게 보내려고 하고, 그 전에 100 Continue 응답을 기다리겠다면, 클라이언트는 값을 100-continue로 하는 Expect 요청 헤더를 보낼 필요가 있음
    - 100-continue는 여러 측면에서 최적화를 위한 것
- 서버와 100 Continue
    - 서버가 100-continue 값이 담긴 Expect 헤더가 포함된 요청을 받으면 응답 혹은 에러 코드로 답해야 함
    - 서버는 절대로 의도하지 않은 클라이언트에게 상태 코드를 보내서는 안됨
    - 서버가 100 Continue 응답을 보낼 기회를 갖기 전에 어떤 이유로 인해 엔티티의 일부를 수신하였다면 서버는 이 상태 코드를 보낼 필요 없음
- 프락시와 100 Continue
    - 홉 서버가 Http/1.1을 따르거나 혹은 어떤 버전을 따르는지 모른다면, Expect 헤더를 포함시켜서 요청을 다음으로 전달해야 함

### 3.4.2 200~299: 성공 상태 코드

- 클라이언트가 요청을 보내면, 그 요청은 대게 성공함

| 상태코드 |               사유 구절                |                                                    의미                                                    |
|:----:|:----------------------------------:|:--------------------------------------------------------------------------------------------------------:|
| 200  |                 OK                 |                                      요청은 정상이고, 엔티티 본문은 요청된 리소스를 포함                                       |
| 201  |              Created               |  서버 개체를 생성하라는 요청을 위한 것, 생성된 리소스에 대한 최대한 구체적인 참조가 담긴 Location 헤더와 함께, 그 리소스를 참조할 수 있는 여러 URL 엔티티를 본문에 포함  |
| 202  |              Accepted              |     요청은 받아들여졌으나, 서버는 아직 그에 대한 어떤 동작도 수행하지 않음. 서버가 요청의 처리를 완료할 것인지 어떤 보장도 없음. 가급적, 언제 완료될 것인지도 포함해야 함     |
| 203  | Non-Authoritatove <br/>Information | 엔티티 헤더에 들어 있는 정보가 원래 ㅓ버가 아닌 리소스의 사본에서 옴. 중개자가 리소스의 사본을 갖고 잇었지만, 리소스에 대한 메타 정보르 검증하지 못한 경우 이런 일이 발생할 수 있음 |
| 204  |             No Content             |                                   응답 메세지는 헤더와 상채줄을 포함하지만 엔티티 본문은 포함 X                                    |
| 205  |           Reset Content            |                  주로 브라우저를 위해 사용되는 또 하나의 코드, 브라우저에게 현재 페이지에 대한 HTML 폼에 채워진 모든 값을 비우라고 말함                  |
| 206  |          Partial Content           |                   부분 혹은 범위 요청이 성공함, 나중에 클라이언트가 특별한 헤더를 사용해서 문서의 부분 혹은 특정 범위를 요청할 수 있음                    |

### 3.4.3 300~399: 리다이렉션 상태 코드

- 리다이렉션 상태 코드는 클라이언트가 관심있어 하는 리소스에 대해 다른 위치를 사용하라고 말해 줌
- 만약 리소스가 옮겨졌다면, 클라이언트에게리소스가 옮겨졌으며 어디서 찾을 수 있는지 알려주기 위해 리다이렉션 상태 코드와 Location 헤더를 보낼 수 있음

| 상태코드 |       사유 구절        |                                                        의미                                                         |
|:----:|:------------------:|:-----------------------------------------------------------------------------------------------------------------:|
| 300  |  Mutiple Choices   |              클라이언트가 동시에 어떤 리소스를 가리키는 URL을 요청한 경우, 그 리소스의 목록과 함께 반환 <br/> 사용자는 목록에서 원하는 하나를 선택할 수  있음              |
| 301  | Moved Permanently  |                           요청한 URL이 옮겨졌을 때 사용, 응답은 Location 헤더에 현재 리소스가 존재하고 있는 URL을 포함                            |
| 302  |       Fount        |         301 상태 코드와 같음 클라이언트는 Location 헤더로 주어진 URL을 리소스를 임시로 가리키기 위한 목적으로 사용해야 함 이후의 요청에서는 원래 URL을 사용 해야 함         |
| 303  |     See Other      |                            클라이언트에게 리소스를 다른 URL에서 가져와야 한다고 말해주고자 할 때 씀. POST 요청에 대한 응답                             |
| 304  |    Not Modified    | 클라이언트는 헤더를 이용해 조건부 요청을 만들 수 있음. 만약 클라이언트가 GET과 같은 조건부 요청을 보냈고, 그 요청한 리소스가 최근에 수정한 일이 없다먄, 이 코드는 리소스가 수정되지 않았음을 의미 |
| 305  |     Use Proxy      |           리소스가 반드시 프락시를 통해서 접근 되어야 함, 프락시의 위치는 Location 헤더를 통해 주어짐, 클라이언트는 이 응답을 통해 특정 리소스에 대한 것이라고만 해석           |
| 306  |        사용 X        |                                                                                                                   |
| 307  | Temporary Redirect |                      301 상태코드와 비슷, 클라이언트는 Location 헤더로 주어진 URL을 리소스를 임시로 가리키기 위한 목적으로 사용해야 함                      |

- 302, 303, 307 상태코드가 유사
    - 302 -> 307

### 3.4.4 400~499: 클라이언트 에러 상태 코드

| 상태코드 |              사유 구절              |                                                     의미                                                     |
|:----:|:-------------------------------:|:----------------------------------------------------------------------------------------------------------:|
| 400  |           Bad Request           |                                               클라이언트가 잘못된 요청                                                |
| 401  |          Unauthorized           |                          리소스를 얻기 전에 클라이언트에게 스스를 인증하라고 요구하는 내용의 응답을 적절한 헤더와 함께 반환                           |
| 402  |        Payment Required         |                                     현재 이 상태 코드는 쓰이지 않음, 미래에 사용될 가능성 있음                                     |
| 403  |            Forbidden            |                                    요청ㅣ 서버에 의해 거부됨 , 거절 사유를 밝히고 싶지 않을 때                                     |
| 404  |            Not Found            |                                            서버가 요청한 URL을 찾을 수 없음                                            |
| 405  |       Method Not Allowed        |                      요청한 URL에 대해 지원하지 않는 메소드로 요청을 받았을 때, 어떤 메서드가 사용 가능한지 클라이언트에게 알려줌                       |
| 406  |         Net Acceptable          | 클라이언트는 자신이 어떤 종류의 엔티티를 받아들이고자 하는지에 대해 매개변수 명시할 수 있음. 이 코드는 주어진 URL에 대한 리소스 중 클라이언트가 받아들 일 수 있는 것이 없는 경우 사용 |
| 407  |  Proxy Authentication Required  |                               401 상태 코드와 같으나, 리소스에 대해 인증을 요구하는 프락시 서버를 위해 사용                               |
| 408  |        Required Timeout         |                                      클라이언트의 요청을 사용하기에 시간이 너무 걸림, 타임아웃                                      |
| 409  |            Conflict             |                                   요청이 리소스에 대해 일으킬 수 있는 몇몇 충돌을 지칭하기 위해 사용                                   |
| 410  |              Gone               |                                     404와 비슷하나 서버가 한 때, 그 리소스를 가지고 있었음                                      |
| 411  |         Length Required         |                               서버가 요청 메세지에 Content-Length 헤더가 있을 것을 요구할 때 사용                                |
| 412  |       Precondition Failed       |                                     클라이언트가 조건부 요청을 했는데, 그 중 하나가 실패한 경우                                     |
| 413  |     Request Entity Too Long     |                                     서버가 처리할 수 있는 혹은 처리하고자 하는 한계를 넘은 경우                                     |
| 414  |      Request URI Too Long       |                                  서버가 처리할 수 있는 혹은 처리하고자 하는 한계를 넘은 URL이 포함                                   |
| 415  |     Unsupproted Media Type      |                                     서버가 이해하거나 지원하지 못하는 내용 유형의 엔티티를 전송                                      |
| 416  | Requested Range Not Satisfiable |                                    요청 메세지가 리소스의 특정 범위를 요청했는데, 그 범위가 잘못됨                                    |
| 417  |       Expectation Failed        |                              요청에 포함된 Expect 요청 헤더에 서버가 만족시킬 수 없는 기대가 담겨 있는 경우                              |

### 3.4.5 500~599: 서버 에러 상태 코드

| 상태코드 |            사유 구절            |                                              의미                                              |
|:----:|:---------------------------:|:--------------------------------------------------------------------------------------------:|
| 500  |    Internal Server Error    |                              서버가 요청을 처리할 수 없게 만드는 에러를 만났을 때 사용                               |
| 501  |        Not Implement        |                     클라이언트가 서버의 능력을 넘은 요청을 했을 때 사용 (서버가 지원하지 않는 메서드를 사용)                      |
| 502  |         Bad Gateway         |      프락시나 게이트웨이처럼 행동하는 서버가 그 요청을 응답 연쇄에 있는 다음 링크로부터 가짜 응답을 맞닥뜨렸을 때 (자신의 부모 게이트웨이 접속 불가)      |
| 503  |     Service Unavailable     | 현재느 서버가 요청을 처리해줄 수 없지만, 나중에는 가능함. 만약 서버가 언제 그 리소스를 사용할 수 있게 될지 알고 있다면 Retry-After 헤더를 응답에 포함 |
| 504  |       Gateway Timeout       |        상태 코드는 408과 비슷, 다른 서버에게 요청을 보내고 응답을 기다리다 타임아웃이 발생한 게이트웨이나 프락시에서 온 응답이라는 점에서 다름        |
| 505  | HTTP vVersion Not Supported |                         서버가 지원할 수 없거나 지원하지 않으려고 하는 버전의 프로토콜로 요청을 받음                          |

<br>

## 3.5 헤더

|   헤더   |                                 설명                                 |                      예시                      |
|:------:|:------------------------------------------------------------------:|:--------------------------------------------:|
| 일반 헤더  |                       클라이언트와 서버 양쪽에서 모두 사용.                        |            Date: Tue, 3 Oct 1974             |
| 요청 헤더  |       요청 메세지를 위한 헤더, 클라이언트가 받고자 하는 데이터의 타입이 무엇인지와 같은 부가정보 제공       |                 Accept: */*                  |
| 응답 헤더  |             응답 메세지는 클라이언트에게 정보를 제공하기 위한 자신만의 헤더를 갖고 있음             |             Server: Tiki-Mut/1.0             |
| 엔티티 헤더 | 엔티티 헤더란 엔티티 본문에 대한 헤더, 엔티티 헤더는 엔티티 본문에 들어있는 데이터의 타입이 무엇인지 말해줄 수 있음 | Content-Type: tect/html; charset-iso-latin-1 |
| 확장 헤더  |   확장 헤더는 애플리케이션 개발자들에 의해 만들어졌지만 아직 승인된 HTTP 명세에는 추가되지 않은 비표준 헤더    |                                              |

### 3.5.1 일반 헤더

|            헤더            |                    설명                     |
|:------------------------:|:-----------------------------------------:|
|        Connection        |        클라이언트와 서버가 요청/응답 연결에 대한 옵션         |
|           Date           |       매새자가 언제 만들어졌는에 대한 날짜와 시간을 제공        |
|       MIME-Version       |           발송자가 사용한 MIME 버전을 알려줌           |
| Trailer chunked transfer |   인코딩으로 인토딩된 메세지의 끛 부분에 위치한 헤더의 목록을 나타냄   |
|    Transfer Encoding     | 수신자에게 안전한 전송을 위해 메세지에 어떤 인코딩이 작동되었는지 말해 줌 |
|         Upgrade          |    발송자가 업그레이드 하길 원하는 새 버전이나 프로토콜을 알려줌     |
|           Via            |         이 메세지가 어떤 중개자를 거쳐 왔는지 보여줌         |

- 일반 캐시 헤더
    - cache-control: 메세지와 함께 캐시 지시자를 전달
    - pragma: 메세지와 함께 지시자를 전달하는 또 다른 방법

### 3.5.2 요청 헤더

- 요청 헤더는

  |    헤더     |              설명               |
            |:---------:|:-----------------------------:|
  | Client-IP |    클라이언트가 실행된 컴퓨터의 IP를 제공     |
  |   From    |     클라이언트 사용자의 메일 주소를 제공      |
  |   Host    |   요청 대상이 되는 서버의 호스트명과 포트를 줌   |
  |  Referer  | 현재의 요청 URI가 들어있었던 문서의 URL을 제공 |

- Accept 관련 헤더
    - 클라이언트는 Accpet 관련 헤더들을 이용해 서버에게 자신의 선호와 능력을 알려줄 수 있음
    - 클라이언트가 무엇을 원하고 할 수 있는지, 그리고 무엇보다도 원치 않는 것은 무엇인지 알려줄 수 있음

- 조건부 요청 헤더
    - 요청에 제약을 넣을 수 있음, 조건부 헤더를 사용하면 클라이언트는 서버에게 요청에 응답하기 전에 먼저 조건이 참인지 확인하는 제약을 포함

- 요청 보안 헤더

  |      헤더       |                            설명                            |
            |:-------------:|:--------------------------------------------------------:|
  | Authorization |          클라이언트가 서버에게 제공하는 인증 그 자체에 대한 정보를 담고 있음          |
  |    Cookie     | 클라이언트가 서버에게 토큰을 전달할 때 사용. 진짜 보안 헤더는 아니지만, 보안에 영향을 줄 수 있음 |
  |    Cookie2    |                  요청자가 지원하는 쿠키의 버전을 알려줌                   |

- 프락시 요청 헤더

- 응답 헤더

|     헤더      |                    설명                     |
  |:-----------:|:-----------------------------------------:|
|     Age     |              응답이 얼마나 오래되었는지               |
|   Public    |      서버가 특정 리소스에 대해 지원하는 요청 메서드의 목록       |
| Retry-After | 현재 리소스가 사용 불가능한 상태일 때, 언제 가능해지는지 날짜 혹은 시각 |

- 협상 헤더

- 응답 보안 헤더

  |         헤더         |                           설명                            |
      |:------------------:|:-------------------------------------------------------:|
  | Proxy-Authenticate |                프락시에서 클라이언트로 보낸 인증요구의 목록                 |
  |     Set-Cookie     | 진짜 보안 헤더는 아니지만, 보안에 영향을 줄 수 있음, 클라이언틑 측에 토큰을 설정하기 위해 사용 |

### 3.5.4 엔티티 헤더

- 엔티티 헤더는 엔티티와 그것의 내용물에 대한 개체의 타입부터 시작해서 주어진 리소스에 대해 요청할 수 있는 유효한 메서드들까지 광범위한 정보를 제공

- 콘텐츠 헤더

  |        헤더        |                 설명                  |
        |:----------------:|:-----------------------------------:|
  |   Content-Base   |   본문에서 사용된 상대 URL을 계산하기 위한 기저 URL   |
  | Content-Encoding |           본문에 적용된 어떤 인코딩            |
  | Content-Language |        본문을 이해하는데 가장 적절한 자연어         |
  |  Content-Length  |             본문의 길이나 크기              |
  | Content-Location |         리소스가 실제로 어디에 위치하는지          |
  |   Content-MD5    |             본문의 MD5 체크섬             |
  |  Content-Range   | 전체 리소스에서 이 엔티티가 해당하는 범위를 바이트 단위로 표현 |
  |   Content-Type   |            이 본문이 어떤 객체인지            |
  
